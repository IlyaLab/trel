epi = {};
epi.cell_types=[
   [0.435579,4.291006,0.999935,"0","cultured pluripotent stem cell"],
[0.222048,4.662498,0.999935,"1","induced pluripotent stem cell"],
[-0.465329,3.89174,0.979205,"2","embryoid body 1"],
[0.388722,5.169699,0.99961,"3","embryoid body 2"],
[-0.303549,3.060788,0.986483,"4","embryoid body 3"],
[-1.348713,-0.114976,0.670068,"5","diff. neuronal progenitor"],
[-4.105993,-0.514994,0.852028,"6","diff. mesenchymal stem cell"],
[-1.259718,2.559635,0.996166,"7","diff. hepatocyte"],
[-2.80434,-1.691631,0.803288,"8","chorion villus cell"],
[-2.862694,-2.309668,0.811866,"9","amniocyte"],
[-0.861776,0.357349,0.745126,10,"cumulus cell"],
[-3.992387,-0.838678,0.709709,11,"germ line stem cell"],
[0.941299,3.30247,0.748245,12,"spermatogonial cell"],
[1.863193,2.286295,0.134845,13,"spermatozoal cell"],
[1.736445,3.719877,"0",14,"MII oocyte, single cells"],
[1.909724,3.339663,0.176761,15,"MII oocyte, pooled cells"],
[0.01737,5.422465,0.982194,16,"primary neural epithel. cell "],
[-0.133043,5.528699,0.955745,17,"definitive neural epithel. cell"],
[0.120207,4.191016,0.715168,18,"neuronal progenitor"],
[1.754783,5.45847,0.019951,19,"pyramidal neuron, entorhinal cortex"],
[1.447857,6.280248,0.434429,20,"pyramidal neuron, hippocampus"],
[1.498921,6.209328,0.45542,21,"pyramidal neuron, midtemporal gyrus"],
[1.499484,6.331494,0.370613,22,"pyramidal neuron, posterior singulate organ"],
[1.510474,6.367681,0.377567,23,"pyramidal neuron, superior frontal gyrus"],
[1.374257,5.89084,0.514882,24,"stellate neuron, entorhinal cortex"],
[1.084651,5.592292,0.450221,25,"macular retina tissue"],
[1.178662,5.700297,0.503834,26,"retina tissue"],
[1.201158,4.769592,0.310372,27,"cerebellar tissue"],
[0.665754,3.097619,0.328698,28,"spinal cord tissue"],
[-0.890884,1.117849,0.520081,29,"dorsal root ganglia tissue"],
[-0.587168,0.788892,0.595269,30,"trigeminal ganglia tissue"],
[-3.898237,-1.393282,0.88634,31,"neural crest tissue"],
[-3.497553,0.234538,0.869964,32,"astrocyte"],
[-1.363963,-0.672567,0.719132,33,"Schwann cell"],
[-2.818831,0.036536,0.672992,34,"dental pulp tissue"],
[-0.649317,1.027367,0.564726,35,"odontoblast"],
[-0.012095,-0.707624,0.662464,36,"conjunctiva epithel. cell"],
[0.805198,-0.171648,0.630101,37,"conjuctiva side population cell"],
[-0.696397,1.083947,0.643164,38,"melanocyte"],
[0.987348,-0.316623,0.473486,39,"skin epithel. cell"],
[-0.030606,-0.913259,0.721406,40,"foreskin epithel. cell"],
[1.581354,-0.043566,0.592345,41,"nasal epithel. cell"],
[1.014874,0.308086,0.691253,42,"oral epithel. cell"],
[0.88827,-0.121036,0.56804,43,"primary gingival epithel. cell"],
[-0.106265,-1.022787,0.63621,44,"immortal. gingival epithel. cell"],
[0.114139,-0.607145,0.68391,45,"immortal. skin epithel. cell"],
[-1.385167,-0.633205,0.701456,46,"ductal breast epithel. cell"],
[-0.916519,-0.549419,0.786457,47,"cultured breast epithel. cell"],
[-1.181202,-1.729625,0.79523,48,"immortal. breast epithel. cell"],
[-3.596552,-0.436517,0.471991,49,"pulmonary smooth muscle"],
[-4.668459,-2.987671,0.697492,50,"aortic smooth muscle"],
[-3.899278,-1.881209,0.663959,51,"coronary smooth muscle cell"],
[-0.562707,0.344274,0.36171,52,"cardiac tissue"],
[0.526088,0.851751,0.34098,53,"skeletal muscle tissue"],
[-4.893021,-1.550829,0.720172,54,"fetal mesenchymal stem cell"],
[-5.085295,-2.197432,0.789186,55,"mesenchymal stem cell"],
[-3.882511,-1.925643,0.720626,56,"adipocyte mesenchymal stem cell"],
[-4.132631,-1.66281,0.72602,57,"lipoma mesenchymal stem cell"],
[-3.218171,-1.654657,0.483559,58,"adipocyte diff. day 21"],
[-1.280938,-1.432563,0.550169,59,"omental adipose tissue"],
[-2.010033,-0.367795,0.518391,60,"subcutaneous adipose tissue"],
[-4.591351,-2.348187,0.530348,61,"osteoblast diff. day 1"],
[-4.601746,-2.337041,0.503769,62,"osteoblast diff. day 3"],
[-4.563752,-2.449086,0.519951,63,"osteoblast diff. day 7"],
[-4.587364,-1.968076,0.512347,64,"osteoblast diff. day 21"],
[-4.587172,-1.844045,0.624838,65,"osteoblast"],
[-4.416247,-2.862223,0.541786,66,"chondrocyte diff. day 1"],
[-4.077735,-2.742874,0.537627,67,"chondrocyte diff. day 3"],
[-4.270413,-2.255241,0.602612,68,"chondrocyte diff. day 7"],
[-4.505848,-1.993628,0.633286,69,"chondrocyte diff. day 21"],
[-4.265821,-2.099969,0.65824,70,"chondrocyte"],
[-1.832404,-0.440642,0.575253,71,"fetal cartilage tissue"],
[-4.68605,-1.752381,0.7938,72,"fetal fibroblast"],
[-4.050272,-1.728351,0.830322,73,"differentiated fibroblast"],
[-3.689206,-1.178419,0.43235,74,"myofibroblast diff."],
[-5.660734,-2.634646,0.717312,75,"cultured skin fibroblast"],
[-4.937878,-1.877584,0.70607,76,"primary skin fibroblast"],
[-3.622734,-0.840159,0.670977,77,"foot fibroblast"],
[-4.573968,-1.019071,0.801924,78,"foreskin fibroblast"],
[-2.781669,-1.343846,0.528724,79,"colon fibroblast"],
[-4.140885,-1.653022,0.700741,80,"cultured lung fibroblast"],
[-4.142745,-1.093875,0.793475,81,"primary lung fibroblast"],
[-3.991612,-1.647405,0.673707,82,"hepatic stellate cell"],
[-3.03743,-1.112161,0.698401,83,"mammary stem cell"],
[-1.46033,-1.697474,0.471861,84,"breast stromal tissue"],
[-1.039701,-0.694287,0.520341,85,"mammary gland tissue"],
[-3.532387,-1.09256,0.719262,86,"prostate stromal cell"],
[-0.098833,0.421352,0.259618,87,"kidney cortex tissue"],
[-0.361992,0.779894,0.327528,88,"kidney medulla tissue"],
[-0.754862,0.545191,0.569665,89,"kidney tissue"],
[-0.601798,5.465831,0.804393,90,"fetal testis week 9-11"],
[-0.302326,5.275817,0.808747,91,"fetal testis week 12-15"],
[-0.452449,5.518982,0.799194,92,"fetal testis week 16-20"],
[-0.313446,6.053659,0.854627,93,"fetal ovary week 9-11"],
[0.356948,5.904614,0.807057,94,"fetal ovary week 12-15"],
[0.392467,5.910369,0.788147,95,"fetal ovary week 16-20"],
[-1.155457,1.519697,0.625032,96,"ovary epithel. cell"],
[-2.080406,-1.794948,0.674552,97,"immortal. ovary epithel. cell"],
[-2.029239,0.869803,0.538017,98,"epididymis tissue"],
[-0.365402,0.274934,0.759748,99,"prostate epithel. cell"],
[-2.835228,-1.423223,0.570964,100,"early-secretory endometrial epithel. cell"],
[-1.402079,-0.170123,0.61223,101,"mid-secretory endometrial epithel. cell"],
[-1.133593,1.210028,0.662334,102,"proliferative endometrial epithel. cell"],
[-1.237002,1.562883,0.655251,103,"post-menopausal endometrial epithel. cell"],
[0.183005,3.582635,0.549389,104,"fallopian tube epithel. cell"],
[-1.588656,-2.311437,0.694437,105,"artery endothelial cell"],
[-1.154477,-1.555893,0.755589,106,"vein endothelial cell"],
[-1.65654,-1.521247,0.765662,107,"microvascular endothelial cell"],
[-1.289769,-1.711354,0.685339,108,"lymphatic endothelial cell"],
[3.903108,-0.812449,0.802573,109,"hematopoietic stem cell"],
[3.282894,-0.609401,0.700546,110,"erythroid progenitor"],
[3.232016,-1.175597,0.704185,111,"erythroblast"],
[3.444396,-1.240705,0.540161,112,"erythrocyte"],
[3.51581,-0.387049,0.408305,113,"platelet"],
[4.580402,-1.524314,0.439758,114,"bone marrow promyelocyte"],
[5.259749,-2.716594,0.312061,115,"bone marrow myeloid progenitor"],
[5.453842,-2.753724,0.037497,116,"neutrophil"],
[5.656137,-4.254575,0.451521,117,"monocyte"],
[4.718878,-2.811536,0.178516,118,"cd16+monocyte"],
[5.129017,-3.683261,0.384325,119,"M1 macrophage diff."],
[5.065352,-3.724541,0.398557,120,"M1 macrophage"],
[5.004715,-3.487681,0.637705,121,"M2 macrophage"],
[4.8142,-3.687382,0.583377,122,"activated M2 macrophage"],
[3.429442,-2.923028,0.636015,123,"alveolar macrophage"],
[3.691274,-3.084834,0.582662,124,"alveolar macrophage from smoker"],
[5.225617,-3.949136,0.463868,125,"myeloid dendritic diff."],
[4.146481,-3.595374,0.675591,126,"myeloid dendritic cell"],
[4.219408,-3.825579,0.644853,127,"activated myeloid dendritic cell"],
[4.179644,-1.938798,0.403236,128,"activated plasmacytoid dendritic cell"],
[5.436549,-1.90422,0.617559,129,"natural killer cell"],
[4.765745,-0.713336,0.214258,130,"natural killer T cell"],
[5.503357,-1.441295,0.590655,131,"regulatory T cell"],
[6.125675,-2.574881,0.612555,132,"naive CD4+ T cell"],
[5.421997,-2.538379,0.670912,133,"activated CD4+ T cell"],
[5.350341,-1.892085,0.335716,134,"central memory CD4+ T cell"],
[5.180303,-1.831868,0.320509,135,"effector memory CD4+ T cell"],
[6.025568,-2.171848,0.495061,136,"naive CD8+ T cell"],
[5.123691,-0.822291,0.263972,137,"activated CD8+ T cell"],
[5.751878,-1.897245,0.56804,138,"naive B cell"],
[5.631956,-2.41093,0.485313,139,"activated B cell"],
[4.524204,-0.81881,0.561087,140,"germinal centre centroblast"],
[4.78261,-0.88608,0.602937,141,"germinal centre centrocyte"],
[4.961707,-1.267073,0.547635,142,"plasma B cell"],
[5.857229,-1.635413,0.535287,143,"memory B cell"],
[-1.723562,3.09333,0.733559,144,"fetal day 50-75 lung"],
[-1.620974,3.012863,0.696777,145,"fetal day 75-100 lung"],
[-1.505307,2.761911,0.664024,146,"fetal day 100-150 lung"],
[1.41888,0.922515,0.743371,147,"fetal liver"],
[1.233091,-0.497972,0.548999,148,"liver tissue"],
[1.450464,-0.08205,0.391669,149,"regenerating liver"],
[1.185706,-0.882455,0.575838,150,"hepatocyte"],
[0.37177,0.715955,0.43326,151,"thyroid tissue"],
[0.065644,0.295486,0.673772,152,"pancreas tissue"],
[0.482728,2.595098,0.504939,153,"pancreatic islets"],
[-4.238225,-2.134831,0.760723,154,"proliferative pancreatic islets"],
[-4.214361,-1.457906,0.710944,155,"re-diff. pancreatic islets"],
[-0.681645,-0.947164,0.729659,156,"esophagus epithel. cell"],
[1.525629,-1.218409,0.556798,157,"ileum epithel. cell"],
[1.456175,-0.255142,0.549064,158,"colon epithel. cell"],
[-0.154333,-0.917169,0.56648,159,"urothelial cell"],
[1.902763,-0.263018,0.694242,160,"pharynx epithel. cell"],
[1.173391,0.78017,0.589355,161,"tracheal epithel. cell"],
[0.406965,-0.717228,0.77073,162,"cultured airway epithel. cell"],
[-1.430463,-1.841989,0.905966,163,"immortal. airway epithel. cell"],
[1.329825,0.643586,0.592865,164,"large airway epithel. cell"],
[1.332713,0.859075,0.5902,165,"small airway epithel. cell"]
];

epi.map = {};
epi.mapBounds = new OpenLayers.Bounds( -7, -7, 7, 7);
epi.mapMinZoom = 1;
epi.mapMaxZoom = 12;

// avoid pink tiles
OpenLayers.IMAGE_RELOAD_ATTEMPTS = 3;
OpenLayers.Util.onImageLoadErrorColor = "transparent";

epi.init = function(div_id){
    var options = {
        controls: [],
        projection: new OpenLayers.Projection("EPSG:900913"),
        displayProjection: new OpenLayers.Projection("EPSG:4326"),
        units: "m",
        maxResolution: 156543.0339,
        maxExtent: new OpenLayers.Bounds(-20037508, -20037508, 20037508, 20037508.34)
    };
    epi.map = new OpenLayers.Map(div_id, options);

    epi.div_id = div_id;


    // create TMS Overlay layer
    var tmsoverlay = new OpenLayers.Layer.TMS( "TMS Overlay", "",
        {   // url: '', serviceVersion: '.', layername: '.',
            type: 'png', getURL: overlay_getTileURL, alpha: true,
            isBaseLayer: true
        });


    epi.map.addLayers([tmsoverlay]);

    epi.map.zoomToExtent( epi.mapBounds.transform(epi.map.displayProjection, epi.map.projection ) );

    epi.map.addControl(new OpenLayers.Control.PanZoomBar());
    epi.map.addControl(new OpenLayers.Control.MousePosition());
    epi.map.addControl(new OpenLayers.Control.MouseDefaults());
    epi.map.addControl(new OpenLayers.Control.KeyboardDefaults());




    var vectorLayer = new OpenLayers.Layer.Vector("Simple Geometry", {
        //styleMap: new OpenLayers.StyleMap({'default':styleMap}),

    });

    epi.points=[];
    for(var i = 0; i<epi.cell_types.length; i++)
    {


        ct=epi.cell_types[i];
        var styleMap = {
            strokeColor: "#000000",
            strokeOpacity: 1,
            strokeWidth: 1,
            fillColor: "#FF0000",
            fillOpacity: 0.5,
            pointRadius: 3,
            pointerEvents: "visiblePainted",
            // label with  linebreaks
            label:ct[4],

            fontColor: "#cceeee",
            fontWeight: "bold",
            fontSize:"8px",
            fontOpacity:1,
            labelSelect:true,
            labelAlign: "cm",
            labelXOffset: 0,
            labelYOffset: 0

        };
        // create a point feature
        var point = new OpenLayers.Geometry.Point(ct[0], ct[1]);
        point.transform(epi.map.displayProjection, epi.map.getProjectionObject());
        var pointFeature = new OpenLayers.Feature.Vector(point,{data:ct},styleMap);


        epi.points.push(pointFeature);
    }

    vectorLayer.events.on({
        'featureselected': function(feature) {
            var ids = [];
            for (var i = this.selectedFeatures.length - 1; i >= 0; i--) {
                this.selectedFeatures[i].style.fillColor="#FFFF00";
                this.selectedFeatures[i].style.fontColor="#EEC";
                //note this.selectedFeatures[i].attributes.data = [x,y,x,id,name]
                //ids.push(this.selectedFeatures[i].attributes.data[3])
                ids.push(this.selectedFeatures[i].attributes.data[4])
            }
            //DICK FIRE SLECTION EVENT(ids)
            //console.log(this.selectedFeatures.length+" selected");
            epi.selectionList = ids;
        },
        'featureunselected': function(feature) {
            var ids = [],
                i;
            for (i = epi.points.length - 1; i >= 0; i--) {
                epi.points[i].style.fillColor="#FF0000";
                epi.points[i].style.fontColor="#CEE";
            }
            for (i = this.selectedFeatures.length - 1; i >= 0; i--) {
                this.selectedFeatures[i].style.fillColor="#FFFF00";
                this.selectedFeatures[i].style.fontColor="#EEC";
                ids.push(this.selectedFeatures[i].attributes.data[4])
            }
            epi.selectionList = ids;
        }
    });
    epi.map.addLayer(vectorLayer);

    vectorLayer.addFeatures(epi.points);

    epi.selectControl=new OpenLayers.Control.SelectFeature(
        vectorLayer,
        {
            clickout: false, toggle: false,
            multiple: false, hover: false,
            toggleKey: "ctrlKey", // ctrl key removes from selection
            multipleKey: "shiftKey", // shift key adds to selection
            box: true
        }
    );
    epi.map.addControl(epi.selectControl);

    epi.map.events.register("moveend", undefined, function() {
        var textSize=Math.min(32,(4+Math.pow(2,epi.map.getZoom())/16))+"px";
        console.log("move: "+ textSize)
        for (var i = epi.points.length - 1; i >= 0; i--) {
            epi.points[i].style.fontSize=textSize;
        }
        vectorLayer.redraw();
    });
    epi.map.events.register("mouseup", undefined, function() {
        //console.log("mouseup")
        vectorLayer.redraw();
    });
};

function toggleSelectActive(component,activate){
    if(activate){
        epi.selectControl.activate();
    }else {
        epi.selectControl.deactivate();
    }
}

function overlay_getTileURL(bounds) {
    var res = this.map.getResolution();
    var x = Math.round((bounds.left - this.maxExtent.left) / (res * this.tileSize.w));
    var y = Math.round((bounds.bottom - this.tileOrigin.lat) / (res * this.tileSize.h));
    var z = this.map.getZoom();
    if (this.map.baseLayer.name == 'Virtual Earth Roads' || this.map.baseLayer.name == 'Virtual Earth Aerial' || this.map.baseLayer.name == 'Virtual Earth Hybrid') {
        z = z + 1;
    }
    if (epi.mapBounds.intersectsBounds( bounds ) && z >= epi.mapMinZoom && z <= epi.mapMaxZoom ) {
        //console.log( this.url + z + "/" + x + "/" + y + "." + this.type);
        return this.url+"tiles/" + z + "/" + x + "/" + y + "." + this.type;
    } else {
        return "http://www.maptiler.org/img/none.png";
    }
}

//function getWindowHeight() {
//    if (self.innerHeight) return self.innerHeight;
//    if (document.documentElement && document.documentElement.clientHeight)
//        return document.documentElement.clientHeight;
//    if (document.body) return document.body.clientHeight;
//    return 0;
//}
//
//function getWindowWidth() {
//    if (self.innerWidth) return self.innerWidth;
//    if (document.documentElement && document.documentElement.clientWidth)
//        return document.documentElement.clientWidth;
//    if (document.body) return document.body.clientWidth;
//    return 0;
//}
//
epi.resize = function (width,height) {
    if (epi.div_id === undefined) return;
    var el = document.getElementById(epi.div_id)
   el.style.height = width + "px";
   el.style.width = height + "px";

   if (epi.map.updateSize) { epi.map.updateSize(); };
};
//
//onresize=function(){ epi.resize(); };

//</script>
//</head>
//<body onload="init()">
//    <!--div id="header"><h1>qgis_epiland.png</h1></div>
//    <div id="subheader">Generated by <a href="http://www.maptiler.org/">MapTiler</a>/<a href="http://www.klokan.cz/projects/gdal2tiles/">GDAL2Tiles</a>, Copyright &copy; 2008 <a href="http://www.klokan.cz/">Klokan Petr Pridal</a>,  <a href="http://www.gdal.org/">GDAL</a> &amp; <a href="http://www.osgeo.org/">OSGeo</a> <a href="http://code.google.com/soc/">GSoC</a>
//    PLEASE, LET THIS NOTE ABOUT AUTHOR AND PROJECT SOMEWHERE ON YOUR WEBSITE, OR AT LEAST IN THE COMMENT IN HTML. THANK YOU -->
//
//<input type="checkbox" id="select_mode" onclick="toggleSelectActive(document.getElementById('select_mode').checked)"/>Select Mode
//<div id="map"></div>
//    <script type="text/javascript" >resize()</script>